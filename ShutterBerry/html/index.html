<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content = "height = device-height, width = 420, user-scalable = no" /> 
    <title>ShutterBerry</title>

    <style type="text/css">
html, body {
	height:100%;
	margin:0;
}
/* Style the list */
ul.tab {
    list-style-type: none;
    margin: 0;
    padding: 0;
    overflow: hidden;
    border: 1px solid #ccc;
    background-color: #f1f1f1;
}
/* Float the list items side by side */
ul.tab li {float: left;}
/* Style the links inside the list items */
ul.tab li a {
    display: inline-block;
    color: black;
    text-align: center;
    padding: 4px 10px;
    text-decoration: none;
    transition: 0.3s;
    font-size: 8px;
}
/* Change background color of links on hover */
ul.tab li a:hover {background-color: #ddd;}
/* Create an active/current tablink class */
ul.tab li a:focus, .active {background-color: #ccc;}
/* Style the tab content */
.tabcontent {
    display: none;
    padding: 6px 12px;
    border: 1px solid #ccc;
    border-top: none;
}
		.ContainerBedBathroom {
			border: 0px solid #DDDDDD;
			width: 150px;
			height: 200px;
			position: relative;}
		
		.ContainerGeneric{
			border: 0px solid #DDDDDD;
			width: 275px;
			height: 206px;
			position: relative;}	
		.ContainerBedBathroomAll {
			border: 0px solid #DDDDDD;
			width: 65px;
			height: 200px;
			position: relative;}
					
       .SingleUpArrow {
            display: block;
				margin-top: 25px;            
	    		margin-left: 60px;
	    		position: absolute;
        		}
       .SingleStopButton {
            display: block;
				margin-top: 85px;            
	    		margin-left: 60px;
	    		position: absolute;
        		}
       .SingleDownArrow {
            display: block;
				margin-top: 125px;            
	    		margin-left: 60px;
	    		position: absolute;
        		}
       .ShuttersOpenBedroom {
            display: block;
				margin-top: 85px;            
	    		margin-left: 95px;
	    		position: absolute;
        		}   
        .ShuttersClosedBedroom {
            display: block;
				margin-top: 85px;            
	    		margin-left: 5px;
	    		position: absolute;
        		}    		 
       .ShuttersOpenGeneric {
            display: block;
				margin-top: 45px;            
	    		margin-left: 150px;
	    		position: absolute;
        		}   
        .ShuttersClosedGeneric {
            display: block;
				margin-top: 45px;            
	    		margin-left: 25px;
	    		position: absolute;
        		}    		 
        		
        .DualUpArrow {
            display: block;
				margin-top: 25px;            
	    		margin-left: 17px;
	    		position: absolute;
        		}
       .DualStopButton {
            display: block;
				margin-top: 85px;            
	    		margin-left: 17px;
	    		position: absolute;
        		}
       .DualDownArrow {
            display: block;
				margin-top: 125px;            
	    		margin-left: 17px;
	    		position: absolute;
        		} 		
         .TimeInput {
         	border: 0px solid #DDDDDD;
				width: 65px;
        		} 		      		
        .DefaultText {
         	font-weight:normal;
         	color: #000000;
         	letter-spacing: 0pt;
         	word-spacing:1pt;
         	font-size: 8pt;
         	font-family: arial, helvetica, sans-serif;
         	text-align: left;
         	line-height:1;
        		} 		  		
        	.ConfirmButton{
        		background-color: #4CAF50;
        		border: none;
        		color: white;
        		padding: 15px 2px;
        		text-align: center;
        		text-decoration: none;
        		display: inline-block;
        		font-size: 16 px;
        		
    </style>
      
   
</head>
<body>
	<div class="DefaultText">
	<div>
			<ul class="tab">
			   <li><a href="#" class="tablinks" onclick="openRoom(event, 'AllRooms')">Alle</a></li>
 				<li><a href="#" class="tablinks" onclick="openRoom(event, 'BedroomBathroom')">Schlafzimmer/Bad-OG</a></li>
  				<li><a href="#" class="tablinks" onclick="openRoom(event, 'Office')">Buro</a></li>
  				<li><a href="#" class="tablinks" onclick="openRoom(event, 'Spareroom')">Spare Room</a></li>
  				<li><a href="#" class="tablinks" onclick="openRoom(event, 'Guestroom')">Gastezimmer</a></li>
  				<li><a href="#" class="tablinks" onclick="openRoom(event, 'GuestBathroom')">Gastebad</a></li>
  				<li><a href="#" class="tablinks" onclick="openRoom(event, 'Kitchen')">Kueche</a></li>
			</ul>
			</div>
		
		<div id="AllRooms" class="tabcontent">
			<div class="ContainerGeneric">
					<div class="ShuttersClosedGeneric" onmousedown="AllClose()"> <a href="#"><img src="close.png" height=80 width= 100 alt="Up"></a></div>
					<div class="ShuttersOpenGeneric" onmousedown="AllOpen()"> <a href="#"><img src="open.png" height=84 width= 100 alt="Up"></a></div>
					<img src="House.jpg" height=200 width=275>
			</div> 
	 <div id="chart_div" style="width: 400px; height: 120px;"></div>
	<input type = "checkbox"  id="SunProtection">Enable Sun Protection<br>
	<input type = "checkbox" id="ReOpen">Re-open after Sun Protection Period<br> 
	<input type = "button" value="Bestaetigung" onclick="SunProtectionUpdate()"><br>
		</div>
		
			<div id="BedroomBathroom" class="tabcontent">
			<table>
				<tr>
						<td>
							<div class="ContainerBedBathroom">
								<div class="SingleUpArrow" onmousedown="VeluxControl('Bedroom', 'Up')"><a href="#"><img src="up.png" height=50 width= 30 alt="Up"></a></div> 
								<div class="SingleStopButton" onmousedown="VeluxControl('Bedroom', 'Stop')"> <a href="#"><img src="stop.png" height=30 width= 30 alt="Up"></a></div> 
								<div class="SingleDownArrow" onmousedown="VeluxControl('Bedroom', 'Down')"> <a href="#"><img src="down.png" height=50 width= 30 alt="Up"></a></div> 
								<div class="ShuttersClosedBedroom" onmousedown="BaierControl('Bedroom', 'Close')"> <a href="#"><img src="close.png" height=30 width= 50 alt="Up"></a></div>
								<div class="ShuttersOpenBedroom" onmousedown="BaierControl('Bedroom', 'Open')"> <a href="#"><img src="open.png" height=30 width= 50 alt="Up"></a></div>
								<img src="Bedroom.jpg" height=200 width=150>
							</div> 
						</td>					
						<td>
							<div class="ContainerBedBathroomAll">
								<div class="DualUpArrow"  onmousedown="VeluxControl('BedBathroom', 'Up')"><a href="#"><img src="up.png" height=50 width= 30 alt="Up"></a></div> 
								<div class="DualStopButton" onmousedown="VeluxControl('BedBathroom', 'Stop')"><a href="#"><img src="stop.png" height=30 width= 30 alt="Up"></a></div> 
								<div class="DualDownArrow" onmousedown="VeluxControl('BedBathroom', 'Down')"><a href="#"><img src="down.png" height=50 width= 30 alt="Up"></a></div> 							
							</div> 
						</td>
						<td>
							<div class="ContainerBedBathroom">
								<div class="SingleUpArrow" onmousedown="VeluxControl('Bathroom', 'Up')"><a href="#"><img src="up.png" height=50 width= 30 alt="Up"></a></div> 
								<div class="SingleStopButton" onmousedown="VeluxControl('Bathroom', 'Stop')"><a href="#"><img src="stop.png" height=30 width= 30 alt="Up"></a></div> 
								<div class="SingleDownArrow" onmousedown="VeluxControl('Bathroom', 'Down')"><a href="#"><img src="down.png" height=50 width= 30 alt="Up"></a></div> 						
							   <img src="Bathroom.jpg" height=200 width=150> </img> 
							</div> 
						</td>		
				</tr>
			</table>
			</div> 
		
			<div id="GuestBathroom" class="tabcontent">
							<div class="ContainerGeneric">
								<div class="ShuttersClosedGeneric" onmousedown="BaierControl('GuestBathroom', 'Close')"> <a href="#"><img src="close.png" height=80 width= 100 alt="Up"></a></div>
								<div class="ShuttersOpenGeneric" onmousedown="BaierControl('GuestBathroom', 'Open')"> <a href="#"><img src="open.png" height=84 width= 100 alt="Up"></a></div>
								<img src="GuestBathroom.jpg" height=200 width=275>
							</div> 
			</div>
			
			
			<div id="Guestroom" class="tabcontent">
							<div class="ContainerGeneric">
								<div class="ShuttersClosedGeneric" onmousedown="BaierControl('Guestroom', 'Close')"> <a href="#"><img src="close.png" height=80 width= 100 alt="Up"></a></div>
								<div class="ShuttersOpenGeneric" onmousedown="BaierControl('Guestroom', 'Open')"> <a href="#"><img src="open.png" height=84 width= 100 alt="Up"></a></div>
								<img src="GuestBedroom.jpg" height=200 width=275>
							</div> 
			</div>
			
		<div id="Kitchen" class="tabcontent">
						 <div class="ContainerGeneric">
								<div class="ShuttersClosedGeneric" onmousedown="BaierControl('Kitchen', 'Close')"> <a href="#"><img src="close.png" height=80 width= 100 alt="Up"></a></div>
								<div class="ShuttersOpenGeneric" onmousedown="BaierControl('Kitchen', 'Open')"> <a href="#"><img src="open.png" height=84 width= 100 alt="Up"></a></div>
								<img src="Kitchen.jpg" height=200 width=275>
						</div> 
		</div>
			
			<div id="Office" class="tabcontent">
							<div class="ContainerGeneric">
								<div class="ShuttersClosedGeneric" onmousedown="BaierControl('Office', 'Close')"> <a href="#"><img src="close.png" height=80 width= 100 alt="Up"></a></div>
								<div class="ShuttersOpenGeneric" onmousedown="BaierControl('Office', 'Open')"> <a href="#"><img src="open.png" height=84 width= 100 alt="Up"></a></div>
								<img src="Office.jpg" height=200 width=275>
							</div> 
			</div>
		
			<div id="Spareroom" class="tabcontent">
							<div class="ContainerGeneric">
								<div class="ShuttersClosedGeneric" onmousedown="BaierControl('Spareroom', 'Close')"> <a href="#"><img src="close.png" height=80 width= 100 alt="Up"></a></div>
								<div class="ShuttersOpenGeneric" onmousedown="BaierControl('Spareroom', 'Open')"> <a href="#"><img src="open.png" height=84 width= 100 alt="Up"></a></div>
								<img src="SpareRoom.jpg" height=200 width=275>
							</div> 
			</div>			
		</div>
		<div id="RoomConfig" class="DefaultText">
		<table>
				<tr>
				<td> </td>
				<td>Auf:</td>
				<td>Zu:</td>	
			</tr>
			<tr>
				<td>Montag->Freitag</td>
				<td><div class="TimeInput"><input type="text" id="WeekdayUp" size="5" pattern="([0-1]{1}[0-9]{1}|20|21|22|23):[0-5]{1}[0-9]{1}"></div></td>
				<td><div class="TimeInput"><input type="text" id="WeekdayDown" size="5" pattern="([0-1]{1}[0-9]{1}|20|21|22|23):[0-5]{1}[0-9]{1}"></div></td>
			</tr>
			<tr>
				<td>Samstag</td>
				<td><div class="TimeInput"><input type="text" id="SaturdayUp" size="5" pattern="([0-1]{1}[0-9]{1}|20|21|22|23):[0-5]{1}[0-9]{1}"></div></td>
				<td><div class="TimeInput"><input type="text" id="SaturdayDown" size="5" pattern="([0-1]{1}[0-9]{1}|20|21|22|23):[0-5]{1}[0-9]{1}"></div></td>
			</tr>
			<tr>
				<td>Sonntag</td>
				<td><div class="TimeInput"><input type="text" id="SundayUp" size="5" pattern="([0-1]{1}[0-9]{1}|20|21|22|23):[0-5]{1}[0-9]{1}"></div></td>
				<td><div class="TimeInput"><input type="text" id="SundayDown" size="5" pattern="([0-1]{1}[0-9]{1}|20|21|22|23):[0-5]{1}[0-9]{1}"></div></td>
			</tr>		
		</table>	
				<input type = "checkbox"  id="AutoShutter">Enable Schedule<br>
				<input type = "checkbox" id="Holidays">Feiertag=Sonntag<br>
				<input type = "checkbox" id="SunRiseSet">Tageslicht Mask<br>
				<input type = "checkbox" id="KackWetter">Kack Wetter Check<br>	
				<input type = "button" value="Bestaetigung" onclick="ConfirmUpdate()"><br>
		</div>
	</div>
</body>
	<script type="text/javascript" src="/webiopi.js"></script>			
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript" >

    	google.charts.load('current', {'packages':['gauge']});
      google.charts.setOnLoadCallback(drawChart);
      function drawChart() {
        var data = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['Inside', -20],
          ['Outside', -20],
        ]);
        var options = {
          width: 400, height: 120,
          greenFrom:19, greenTo: 22,
          yellowFrom:22, yellowTo: 30,
          redFrom:30, redTo: 40,
          minorTicks: 5,
          majorTicks: ['-20', '-10', '0', '10', '20', '30', '40'],
          max: 40,
          min: -20
        };
        var chart = new google.visualization.Gauge(document.getElementById('chart_div'));
        chart.draw(data, options);
        
		  var updateTemps = function(macro, args, response) {
          var myTemps = response.split(";");
			 data.setValue(0, 1,myTemps[0]);
          chart.draw(data, options);
          data.setValue(1, 1, myTemps[1]);
          chart.draw(data, options);
          }
       webiopi().callMacro("getTemps", [], updateTemps)
		
        setInterval(function() {
          var updateTemps = function(macro, args, response) {
          var myTemps = response.split(";");
			 data.setValue(0, 1,myTemps[0]);
          chart.draw(data, options);
          data.setValue(1, 1, myTemps[1]);
          chart.draw(data, options);
          }
       webiopi().callMacro("getTemps", [], updateTemps); 
       },10000);      
      }
   
   
   var MyRoom = "blah"
	webiopi().ready(function() { 
	openRoom(event, "AllRooms") 
	});
		
		// Confirm/Bestaetigung button just gets all the values of the elements and passes them to the Python Macro which will write them to a file (/home/pi/ShutterBerry/python/BedroomBathroom.cfg)
		// and generally do what needs to be done with them.
		function ConfirmUpdate() {
			
			// just set the array to 10 numbers so we can have distinct lines to set each element properly
			var CurrentConfig = [1,2,3,4,5,6,7,8,9,10,11];
			CurrentConfig[0] =MyRoom;
			CurrentConfig[1] = document.getElementById("WeekdayUp").value;
			CurrentConfig[2] = document.getElementById("WeekdayDown").value;
			CurrentConfig[3] = document.getElementById("SaturdayUp").value;
			CurrentConfig[4] = document.getElementById("SaturdayDown").value;
			CurrentConfig[5] = document.getElementById("SundayUp").value;
			CurrentConfig[6] = document.getElementById("SundayDown").value;			
			CurrentConfig[7] = document.getElementById("AutoShutter").checked;
			CurrentConfig[8] = document.getElementById("Holidays").checked;
			CurrentConfig[9] = document.getElementById("SunRiseSet").checked;
			CurrentConfig[10] = document.getElementById("KackWetter").checked;						
						
			webiopi().callMacro("setShutterConfig", CurrentConfig);
			
			alert("Settings Updated!")
			}
		
		function SunProtectionUpdate() {
			// just set the array to 2 numbers so we can have distinct lines to set each element properly
			var SunProtectionFlags = [1,2];
			SunProtectionFlags[0] = document.getElementById("SunProtection").checked;
			SunProtectionFlags[1] = document.getElementById("ReOpen").checked;						
					
			webiopi().callMacro("setSunProtectionFlags", SunProtectionFlags);
			
			alert("Settings Updated!")
			}	        
			
       
		//Functions associated to pictures which call relevant Python Macros for manual shutter control...fairly self explanatory...			
		function VeluxControl(roomName, Action) {
			var roomNameAction = [1,2];
			
			//Run Twice in case it's the Bedroom & Bathroom Together	- Once for each room	
			if(roomName == "BedBathroom"){						
				roomNameAction[0] = "Bedroom";
				roomNameAction[1] = Action;
				webiopi().callMacro("VeluxControl", roomNameAction);
				roomNameAction[0] = "Bathroom";
				roomNameAction[1] = Action;
				webiopi().callMacro("VeluxControl", roomNameAction);			
				}
			
			//Otherwise, just run for the specified room.	
			if(roomName != "BedBathroom"){						
				roomNameAction[0] = roomName;
				roomNameAction[1] = Action;
				webiopi().callMacro("VeluxControl", roomNameAction);
				}	
				
			}
			
		function BaierControl(roomName, Action) {
			var roomNameAction = [1,2];
			roomNameAction[0] = roomName;
			roomNameAction[1] = Action;		
			webiopi().callMacro("BaierControl", roomNameAction);
			}	
			
		function AllOpen()	{
			VeluxControl('Bedroom', 'Up');	
			VeluxControl('Bathroom', 'Up');	
				BaierControl('Bedroom','Open');
				BaierControl('GuestBathroom', 'Open');
				BaierControl('Spareroom', 'Open');
				BaierControl('Office', 'Open');
				BaierControl('Kitchen', 'Open');
				BaierControl('Guestroom', 'Open');
			} 
			function AllClose()	{
				VeluxControl('Bedroom', 'Down')	;
				VeluxControl('Bathroom', 'Down');	
				BaierControl('Bedroom','Close');
				BaierControl('GuestBathroom', 'Close');
				BaierControl('Spareroom', 'Close');
				BaierControl('Office', 'Close');
				BaierControl('Kitchen', 'Close');
				BaierControl('Guestroom', 'Close');
			} 		
	
		function openRoom(evt, roomName) {
    		var i, tabcontent, tablinks;
		
		//myRoom is a global also used for the ConfirmUpdate
		MyRoom = roomName;
    	// Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    // Show the current tab, and add an "active" class to the link that opened the tab
    document.getElementById(MyRoom).style.display = "block";
    evt.currentTarget.className += " active";
	
	//Don't want to run this for the "All Rooms" page	
	if(MyRoom!="AllRooms") 	{
	// Don't really understand what's going on here - updated from Macro tutorial
	// Functionally, it gets the Configuration from the file 	(/home/pi/ShutterBerry/python/BedroomBathroom.cfg) via python macro
	// and then sets values of various html elements 
	        document.getElementById("RoomConfig").style.visibility="visible" ;   
			var updateConfig = function(macro, args, response) {
           var myConfig = response.split(";");
         	              		
           	
           	//Don't use the WebIOPI library as it doesn't add value.	
           	//Text Boxes
           document.getElementById("WeekdayUp").value = myConfig[0];
           document.getElementById("WeekdayDown").value = myConfig[1];
           document.getElementById("SaturdayUp").value = myConfig[2];
           document.getElementById("SaturdayDown").value = myConfig[3]; 
           document.getElementById("SundayUp").value = myConfig[4];
           document.getElementById("SundayDown").value = myConfig[5];     
 			  
 			  //Check Boxes. Slightly more work as we have to use Boolean, not string. 
 			  //On reload, boxes are unchecked. Only check if relevant variable is true (and then check the box), otherwise leave unchecked
 			  // Probably a cleaner way to do this...
				if(myConfig[6] =="true") 	{
						document.getElementById("AutoShutter").checked = true; 
						}	
				if(myConfig[6] =="false") 	{
						document.getElementById("AutoShutter").checked = false; 
						}				  
 				if(myConfig[7] =="true") 	{
 			  			document.getElementById("Holidays").checked = true ; 
 			 			}
 	 			if(myConfig[7] =="false") 	{
 			  			document.getElementById("Holidays").checked = false ; 
 			 			}		 			
 			  if(myConfig[8] =="true") 	{
 			  			document.getElementById("SunRiseSet").checked = true;
 			  			}
 			   if(myConfig[8] =="false") 	{
 			  			document.getElementById("SunRiseSet").checked = false;
 			  			}			
 			  if(myConfig[9] =="true") 	{
 			  			document.getElementById("KackWetter").checked =  true;
        				}
        		if(myConfig[9] =="false") 	{
 			  			document.getElementById("KackWetter").checked =  false;
        				}		
        				
				}
				
			
        		webiopi().callMacro("getShutterConfig", roomName, updateConfig);
        		}
        		if(MyRoom=="AllRooms") 	{
        		
				document.getElementById("RoomConfig").style.visibility="hidden" ;  
				
				var updateSunProtectionFlags = function(macro, args, response) {
           var myFlags = response.split(";");
         	              		
				if(myFlags[0] =="true") 	{
						document.getElementById("SunProtection").checked = true; 
						}	
				if(myFlags[0] =="false") 	{
						document.getElementById("SunProtection").checked = false; 
						}				  
 				if(myFlags[1] =="true") 	{
 			  			document.getElementById("ReOpen").checked = true ; 
 			 			}
 	 			if(myFlags[1] =="false") 	{
 			  			document.getElementById("ReOpen").checked = false ; 
 			 			}		 			
 			        				
				}
				
			
        		webiopi().callMacro("getSunProtectionConfig", [] , updateSunProtectionFlags);
        		}
}			
		</script>
</html>